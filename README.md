# BUAA-Compiler-2020

> 北京航空航天大学计算机学院《编译原理》课程。
>
> 基于C++，目标语言为MIPS汇编，实现的递归下降子程序分析的编译器。
>
> 文法定义见主分支根目录下的Grammar.md。



## 1. 关于分支

| Branch名称 | 描述 |
| ---- | ---- |
|  `Lexer`    | 词法分析阶段代码 |
|   `GrammarAnalyzer`   | 语法分析阶段代码 |
|   `ErrorHandle`   | 错误处理阶段代码 |
|   `MipsAnalyzer`   | 生成MIPS目标代码 |
|   `CodeOptimize`   | 代码优化（临时与全局寄存器分配等） |
|   `IRCodeOutput`   | 按照课程组要求输出标准格式的目标代码 |
|   `CodeOptimizeLast`   | 用于竞速/期末上机的最终版本，宏定义开关调试完毕 |

最终版本竞速排名在30~50之间。分支跳转方式：`git checkout xxxxxxxx`。



## 2. 上机建议

趁着刚考完期末上机，赶紧回忆一下。（现在再看我的CO代码，已经完全看不懂了……）



### 2.1 期中上机考试

考试的范围截止到语法分析（不包括错误处理），相对来说比较简单。

去年（2019）的文法和今年的主要区别是：

- 去年有do while语句，今年则改为了switch语句

- 2020增加了变量定义及初始化、二维数组等

于是期中考是do while语句的词法分析和语法分析，输出对应的成分。

此外还包括填空题和Pascal语言的考察，建议带一本狼书《编译技术》。



### 2.2 期末上机考试

分为PCODE和MIPS两组。

一共五道题，第一题是和其中差不多的新增文法，第二题是错误处理，这两题都是基于新文法的。

修改的文法内容：

```
＜循环语句＞   ::=  repeat '{'＜语句＞'}'until'('＜条件＞')'| for'('＜标识符＞＝＜表达式＞;＜条件＞;＜标识符＞＝＜标识符＞(+|-)＜步长＞')'＜语句＞
＜情况子语句＞  ::=  case＜常量＞{,＜常量＞}：＜语句＞
```

需要注意的是考场文法中while直接被删掉了，貌似有的同学做的时候没删完全，那就不能完成错误处理了。

三四五问是选做题，我选的是MIPS所以做的三五。三内部包括4小问：

- 分析给定程序中某函数的运行栈（不会写），说说你是如何访问二维数组的。
- （选做）对于完成了染色法分配全局寄存器的同学，说说你的实现。
- （选做）对于完成了临时寄存器分配的同学，说说你的实现。
- （选做）对于完成了DAG图表达式优化的同学，说说你的实现。

作为大废物的我只写了1和3，而且感觉完全没写对……希望补考名单没有我。

最后五是让你提交给定测试程序的优化前后的中间代码和目标代码。



## 3. 总结感想

### 3.1 各部分任务

- 词法分析的内容还算基础。开始学习了一些C++的知识。
- 语法分析在之前的词法分析基础上进行修改。在这次我周围不少同学因为中文的输出而产生问题，比如我的一个舍友在奇数个中文时会显示乱码，还有群里出现的最后两个汉字乱码的问题……这个貌似只能解释称Windows的锅；另外还有因为“\n \r”的各种问题，如果不是自己过滤输入中的空白字符应该就不会发生。
- 错误处理开头又把语法分析的遗留问题重新整理了一遍。另外这次错误处理的课下测试点感觉也不强，比如我之前对于形如`while(1)`的语句部分为空语句，但缺少分号的情况就无法正确处理，结果也通过了全部测试点……不知道是为了避免歧义不做考察还是挖坑，但这意味着我的错误处理代码还是有可能存在其他问题的。
- 代码生成时其他科目的DDL都来了，时间很紧张，Bug很多。
- 代码优化时马上就要考试了，更加感受到了自己的无知和弱小。



### 3.2 课程改进建议

- 限定中间代码格式，比如LLVM的我觉得就很不错
- 允许采用其他高级语言开发编译器
- 调整时间安排，其实我觉得代码生成大部分是和编译课程无关的劳动，从结果上看能做DAG图、活跃变量分析等的同学占总数应该不多？如果能直接将代码优化改为面向特定格式中间代码的优化，或者提供一部分模块减少代码生成的工作量，就能减少前面De词法语法分析Bug的时间，我觉得课程的教学效果会更好。



### 3.3 吐槽

- 啥都没学会，代码写的惨不忍睹，理论考的一塌糊涂
- 幸好我没有用智能指针，**C++给爷爬**
- 某天我花了一下午debug，最后发现原来C++在更新Map的值之前要先erase???
- 你6能不能开点投入时间和学分成正比的阳间课程???



以上，祝路过的同学学业有成，天天开心。